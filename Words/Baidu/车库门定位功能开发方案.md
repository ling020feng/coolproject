### 车库门定位功能开发方案

在下载定位SDK包，在布局文件以及申明文件中配置好定位相关的环境以后，通过定位流程可实现定位。

#### **定位流程**

1、开启定位图层 

2、初始化定位服务

3、设置定位监听以及在监听方法内构造定位数据

其中定位数据包括：经度、纬度、方向、半径等。

4、定位生命周期

5、设置覆盖物（可拖动的图标，用来实现更准确的定位车库门位置）

#### *功能*

可实现定位当前位置以及拖动图标实现更具体的定位方案。

#### **遇到的问题**

##### 问题一：定位到非洲附近

原因：在安卓6.0以后，谷歌对一些危险权限有一些设定，其中定位权限就包括在九大危险权限之中。所以想要准确定位，就需要在Java代码中动态添加所需要的权限。

##### 问题二：闪退

原因一：没有初始化地图

原因二：布局文件中未添加百度的布局文件

原因三：方法使用不当

**问题三：拖动红色图标后马上红色图标又与当前定位绑定在一起或进入界面不拖动红色图标重进时闪退**

原因一：由于红色覆盖物图标默认地方在北京，因此要使用拖动功能时需要从北京拖到深圳，比较麻烦

我将拖动图标与定位图标绑定在一起，这样进入页面时，红色图标就在当前定位位置。由于定位是实时定位

因此，拖动图标以后过一秒钟又会重新和定位图标再次绑定。

原因二：首次进入页面不拖动红色图标再进闪退问题，由于每隔一秒种就会定位一次，导致红色图标拖动没意义，

我将在定位监听方法中设置了判断：只在第一次定位时与红色图标绑定，这样就不会因为下一次定位而重新将

红色图标绑定 回当前位置，但如果第一次不拖动图标，再进页面时已不是第一次定位，导致红色图标不能正确初始化而闪退。

